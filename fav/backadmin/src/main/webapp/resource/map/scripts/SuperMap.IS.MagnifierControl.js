//================================================================================ 
// SuperMap IS .NET 客户端程序，版权所有，北京超图软件股份有限公司，2000-2008。 
// 本程序只能在有效的授权许可下使用。未经许可，不得以任何手段擅自使用或传播。 
// 作 者:  SuperMap IS Web Team 
// 版 本:  $Id: SuperMap.IS.MagnifierControl.js,v 1.42.2.6 2009/09/30 01:04:20 zengyw Exp $
// 文 件:  SuperMap.IS.MagnifierControl.js 
// 描 述:  AjaxScripts 放大镜控件 
// 更 新:  $Date: 2009/09/30 01:04:20 $ 
//================================================================================ 
SuperMap.IS.MagnifierControl=function(container,map,param){this.width=200;if(param&&typeof (param.width)!="undefined"){this.width=param.width}this.height=200;if(param&&typeof (param.height)!="undefined"){this.height=param.height}this.headHeight=20;if(param&&typeof (param.headHeight)!="undefined"){this.headHeight=param.headHeight}this.headBackColor="SkyBlue";if(param&&typeof (param.headBackColor)!="undefined"){this.headBackColor=param.headBackColor}this.minZoomRadio=2;if(param&&typeof (param.minZoomRadio)!="undefined"){this.minZoomRadio=param.minZoomRadio}this.maxZoomRadio=6;if(param&&typeof (param.maxZoomRadio)!="undefined"){this.maxZoomRadio=param.maxZoomRadio}this.closeButton=true;if(param&&typeof (param.closeButton)!="undefined"){this.closeButton=param.closeButton}this.closeButtonImg="images/close.gif";if(param&&typeof (param.closeButtonImg)!="undefined"){this.closeButtonImg=param.closeButtonImg}this.draggable=true;if(param&&typeof (param.draggable)!="undefined"){this.draggable=param.draggable}this.expandCollapseButton=true;if(param&&typeof (param.expandCollapseButton)!="undefined"){this.expandCollapseButton=param.expandCollapseButton}this.expandButtonImg="images/restore.gif";if(param&&typeof (param.expandButtonImg)!="undefined"){this.expandButtonImg=param.expandButtonImg}this.collapseButtonImg="images/mini.gif";if(param&&typeof (param.collapseButtonImg)!="undefined"){this.collapseButtonImg=param.collapseButtonImg}this.expanded=true;if(param&&typeof (param.expanded)!="undefined"){this.expanded=param.expanded}this.title="";if(param&&typeof (param.title)!="undefined"){this.title=param.title}this.headFont=new SuperMap.IS.Font();if(param&&typeof (param.headFont)!="undefined"){var headFont=_eval("("+param.headFont+")");this.headFont.FromJSON(headFont);headFont=null}this.headBackgroundImage="";if(param&&typeof (param.headBackgroundImage)!="undefined"){this.headBackgroundImage=param.headBackgroundImage}this.headSeparatorLine=true;if(param&&typeof (param.headSeparatorLine)!="undefined"){this.headSeparatorLine=param.headSeparatorLine}this.left=0;if(param&&typeof (param.left)!="undefined"){this.left=param.left}this.top=0;if(param&&typeof (param.top)!="undefined"){this.top=param.top}var _mapContainer;var _startMoving=false;var _leftForMagnifier;var _topForMagnifier;var _leftForMapContainer;var _topForMapContainer;var _magnifierBody;var _centerPix;var _curMapScale;var _self=this;var _oldleft;var _oldtop;var _hidden=false;var _vertCross;var _horizCross;var _lastMapName;var _oldMousePositionX;var _oldMousePositionY;var _containerInside=null;var _containerBorderWidthOfLeftAndRight=0;this.Destroy=_Destroy;this.Close=_Close;this.Collapse=_Collapse;this.Expand=_Expand;this.Update=_Update;this.RefreshImage=_RefreshImage;if(map){map.AttachEvent("oninit",_Init);map.AttachEvent("ondestroying",_Destroy)}function _Init(){if(_containerInside&&_containerInside.parentNode){_containerInside.parentNode.removeChild(_containerInside)}_containerInside=document.createElement("div");_containerInside.style.position="absolute";_containerInside.style.width=_self.width+"px";_containerInside.style.height=_self.height+"px";_containerInside.style.overflow="hidden";container.onmousedown=_OnMouseDown;container.onmousemove=_OnMouseMove;container.onmouseup=_OnMouseUp;container.ondblclick=_OnDblClick;container.onmousewheel=_OnMouseWheel;container.style.position="absolute";container.style.display="block";_mapContainer=map.workLayer;container.style.zIndex=21;container.style.left=_self.left+"px";container.style.top=_self.top+"px";container.appendChild(_containerInside);if(container.style.borderWidth){_containerBorderWidthOfLeftAndRight=container.offsetWidth-container.clientWidth}_mapContainer.appendChild(container);_Render();_lastMapName=map.mapName;if(map){map.AttachEvent("onchangeview",_RefreshImage)}}function _InitProperty(){_self.width=param.width;_self.height=param.height;_self.headHeight=param.headHeight;_self.headBackColor=param.headBackColor;_self.minZoomRadio=param.minZoomRadio;_self.maxZoomRadio=param.maxZoomRadio;_self.closeButton=param.closeButton;_self.closeButtonImg=param.closeButtonImg;_self.draggable=param.draggable;_self.expandCollapseButton=param.expandCollapseButton;_self.expandButtonImg=param.expandButtonImg;_self.collapseButtonImg=param.collapseButtonImg;_self.expanded=param.expanded;_self.title=param.title;_self.headFont=_eval("("+param.headFont+")");_self.headBackgroundImage=param.headBackgroundImage;_self.headSeparatorLine=param.headSeparatorLine}function _Destroy(){if(map){map.DetachEvent("onchangeview",_RefreshImage);map.DetachEvent("oninit",_Init);map.DetachEvent("ondestroying",_Destroy)}_mapContainer=null;_magnifierBody=null;_centerPix=null;_curMapScale=null;_self=null;_oldleft=null;_oldtop=null;_hidden=null;_vertCross=null;_horizCross=null;_lastMapName=null;_oldMousePositionX=null;_oldMousePositionY=null;if(_containerInside&&_containerInside.parentNode){_containerInside.parentNode.removeChild(_containerInside)}container.innerHTML="";_containerInside=container=param=null}function _RefreshImage(){if(!_lastMapName){_lastMapName=map.mapName;return }if(_hidden){return }_lastMapName=map.mapName;_centerPix=new SuperMap.IS.PixelCoord(_leftForMagnifier+parseInt(_magnifierBody.style.width)/2+_magnifierBody.offsetLeft+1,_topForMagnifier+parseInt(_magnifierBody.style.height)/2+_magnifierBody.offsetTop+1);_curMapScale=map.GetMapScale();var center=map.PixelToMapCoord(_centerPix,_curMapScale);var viewer=new SuperMap.IS.PixelRect(0,0,parseInt(_magnifierBody.style.width),parseInt(_magnifierBody.style.height));var select=document.getElementById(container.id+"_ZoomRadio");if(!center.x||!center.y||!viewer||!select){return }var zoomRadio=select.options[select.selectedIndex].value;var mapParam=new SuperMap.IS.MapParam(map.mapName,_curMapScale*zoomRadio);mapParam.pixelRect=viewer;mapParam.center=center;map.GetMapImage(mapParam,OnGetMapImageComplete,OnGetMapImageError);mapParam.Destroy();viewer=null;center=null;select=null}function _Close(e){e=_GetEvent(e);if(e){_CancelBubble(e)}_magnifierBody.style.display="none";container.style.height=_self.height-parseInt(_magnifierBody.style.height)+"px";_oldleft=container.style.left;_oldtop=container.style.top;container.style.left=_self.left+"px";container.style.top=_self.top+"px";_magnifierBody.style.backgroundImage="url(images/spacer.gif)";_magnifierBody.style.backgroundRepeat="no-repeat";var img=document.getElementById(container.id+"_expandCollapse");img.src=_self.expandButtonImg;img.onclick=_Expand;_vertCross.style.display="none";_horizCross.style.display="none";_hidden=true}function _Expand(e){if(!_hidden){return }e=_GetEvent(e);if(e){_CancelBubble(e)}_magnifierBody.style.display="block";container.style.height=_self.height+"px";container.style.left=_oldleft;container.style.top=_oldtop;_hidden=false;var img=document.getElementById(container.id+"_expandCollapse");img.src=_self.collapseButtonImg;_vertCross.style.display="block";_horizCross.style.display="block";img.onclick=_Collapse}function _Collapse(e){e=_GetEvent(e);if(e){_CancelBubble(e)}_magnifierBody.style.display="none";_oldleft=container.style.left;_oldtop=container.style.top;container.style.height=_self.height-parseInt(_magnifierBody.style.height)+"px";container.style.overflow="hidden";_magnifierBody.style.backgroundImage="url(images/spacer.gif)";_magnifierBody.style.backgroundRepeat="no-repeat";var img=document.getElementById(container.id+"_expandCollapse");img.src=null;img.src=_self.expandButtonImg;img.onclick=null;img.onclick=_Expand;_vertCross.style.display="none";_horizCross.style.display="none";_hidden=true}function _OnMouseDown(e){e=_GetEvent(e);var target=_GetTarget(e);_CancelBubble(e);var panAction=new SuperMap.IS.PanAction();map.SetAction(panAction);if(target.tagName=="IMG"||target.tagName=="SELECT"||target.tagName=="OPTION"){return }if(!_self.draggable){return }var mouseX=_GetMouseX(e);var mouseY=_GetMouseY(e);_oldMousePositionX=mouseX;_oldMousePositionY=mouseY;_magnifierBody.style.backgroundImage="url(images/spacer.gif)";_magnifierBody.style.backgroundRepeat="no-repeat";_startMoving=true;_vertCross.style.display="block";_horizCross.style.display="block";return false}function _OnMouseMove(e){if(!_startMoving){return false}e=_GetEvent(e);var mouseX=_GetMouseX(e);var mouseY=_GetMouseY(e);var offsetX=mouseX-_oldMousePositionX;var offsetY=mouseY-_oldMousePositionY;_leftForMagnifier=parseInt(container.style.left)+offsetX;_topForMagnifier=parseInt(container.style.top)+offsetY;container.style.left=_leftForMagnifier+"px";container.style.top=_topForMagnifier+"px";_oldMousePositionX=mouseX;_oldMousePositionY=mouseY;_CancelBubble(e);return false}function _OnMouseUp(e){e=_GetEvent(e);var target=_GetTarget(e);_CancelBubble(e);if(target.tagName=="IMG"||target.tagName=="SELECT"||target.tagName=="OPTION"){return false}_RefreshImage();_startMoving=false;_vertCross.style.display="none";_horizCross.style.display="none";_oldleft=container.style.left;_oldtop=container.style.top;return false}function _OnDblClick(e){if(_hidden){_Expand(e)}else{_Collapse(e)}return false}function _OnMouseWheel(e){e=_GetEvent(e);_CancelBubble(e);return false}function OnGetMapImageComplete(mapUrl){_magnifierBody.style.backgroundImage="url("+mapUrl+")";_magnifierBody.style.backgroundRepeat="no-repeat";var _browser=_ygPos.browser;if(_browser=="opera"){_containerInside.removeChild(_magnifierBody);_containerInside.appendChild(_magnifierBody)}}function OnGetMapImageError(){}function _RenderHead(){var head=document.createElement("div");head.id=container.id+"_Head";head.style.backgroundColor=_self.headBackColor;head.style.width=_self.width+"px";head.style.height=_self.headHeight+"px";if(_self.headSeparatorLine){head.style.borderBottom="1px solid black"}if(_self.headFont){head.style.fontFamily=_self.headFont.fontFamily.name;head.style.fontSize=_self.headFont.size;if(_self.headFont.bold){head.style.fontWeight="bold"}if(_self.headFont.italic){head.style.fontStyle="italic"}if(_self.headFont.underline&&_self.headFont.strikeout){head.style.textDecoration="underline line-through"}else{if(_self.headFont.underline){head.style.textDecoration="underline"}else{if(_self.headFont.strikeout){head.style.textDecoration="line-through"}}}}if(_self.headBackgroundImage){head.style.backgroundImage="url("+_self.headBackgroundImage+")"}var headHtml="<table><tr><td width="+_self.width*0.4+">";if(_self.title){headHtml+=_self.title}headHtml+="</td>";headHtml+="<td  width="+_self.width*0.3+" valign='top'>";headHtml+="<select style='width:100%;font-family:宋体;font-size:"+_self.headHeight*0.6+"px' id='"+container.id+"_ZoomRadio' onchange='"+container.id+".RefreshImage();'>";for(var i=_self.minZoomRadio;i<=_self.maxZoomRadio;i++){headHtml+="<option value="+i+" >"+i+"x</option>"}headHtml+="</select>";headHtml+="</td>";headHtml+="<td align='right' valign='top' width="+_self.width*0.3+" >";if(_self.expandCollapseButton){headHtml+="<img id='"+container.id+"_expandCollapse' src='"+_self.collapseButtonImg+"' />"}if(_self.closeButton){headHtml+="<img id='"+container.id+"_close' src='"+_self.closeButtonImg+"' />"}headHtml+="</td>";headHtml+="</tr></table>";head.innerHTML=headHtml;_containerInside.appendChild(head);var img=document.getElementById(container.id+"_expandCollapse");if(img){img.onclick=_Collapse}img=document.getElementById(container.id+"_close");if(img){img.onclick=_Close}}function _RenderBody(){_magnifierBody=document.createElement("div");_magnifierBody.style.width=_self.width+"px";_magnifierBody.style.height=_self.height-_self.headHeight-_containerBorderWidthOfLeftAndRight+"px";_magnifierBody.style.position="absolute";_magnifierBody.id=container.id+"_Body";_vertCross=document.createElement("div");_vertCross.style.width="20px";_vertCross.style.height="2px";_vertCross.style.fontSize=0;_vertCross.style.backgroundColor="red";_vertCross.style.position="absolute";_vertCross.id=container.id+"_vertCross";_vertCross.style.top=parseFloat(_magnifierBody.style.height)/2-parseFloat(_vertCross.style.height)/2+"px";_vertCross.style.left=parseFloat(_magnifierBody.style.width)/2-parseFloat(_vertCross.style.width)/2+"px";_magnifierBody.appendChild(_vertCross);_horizCross=document.createElement("div");_horizCross.style.width="2px";_horizCross.style.height="20px";_horizCross.style.backgroundColor="red";_horizCross.style.position="absolute";_horizCross.id=container.id+"_HorizCross";_horizCross.style.top=parseFloat(_magnifierBody.style.height)/2-parseFloat(_horizCross.style.height)/2+"px";_horizCross.style.left=parseFloat(_magnifierBody.style.width)/2-parseFloat(_horizCross.style.width)/2+"px";_magnifierBody.appendChild(_horizCross);_magnifierBody.style.backgroundImage="url(images/spacer.gif)";_magnifierBody.style.backgroundRepeat="no-repeat";_containerInside.appendChild(_magnifierBody)}function _Render(){_RenderHead();_RenderBody();if(!_self.expanded){_Collapse()}else{container.style.left=_self.left+"px";container.style.top=_self.top+"px"}}function _SetPropertyHidden(){var o=new Object();o.width=_self.width;o.height=_self.height;o.headHeight=_self.headHeight;o.minZoomRadio=_self.minZoomRadio;o.maxZoomRadio=_self.maxZoomRadio;o.closeButton=_self.closeButton;o.draggable=_self.draggable;o.expandCollapseButton=_self.expandCollapseButton;o.expanded=_self.expanded;o.title=_self.title;var propertyJSON=_ToJSON(o);var hidden=document.getElementById(container.id+"_hiddenProperty");if(hidden){hidden.value=propertyJSON}}function _Update(){_InitProperty();_Render();_SetPropertyHidden()}}
